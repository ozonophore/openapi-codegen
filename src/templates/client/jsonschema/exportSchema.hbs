{{>header}}

{{#if imports}}
{{#each imports}}
import { {{{name}}}Schema{{#if alias}} as {{{alias}}}Schema{{/if}} } from '{{{normalizePath path}}}';
{{/each}}
{{/if}}

import Ajv from 'ajv';
import addFormats from 'ajv-formats';

const ajv = new Ajv({ allErrors: true });
addFormats(ajv);

export const {{{name}}}Schema = {{>jsonschemaSchema}};

export type {{{name}}} = any; // JSON Schema doesn't provide type inference

export function validate{{{name}}}(data: unknown): { valid: true; data: {{{name}}} } | { valid: false; errors: Ajv.ErrorObject[] } {
    const validate = ajv.compile({{{name}}}Schema);
    const valid = validate(data);
    if (valid) {
        return { valid: true, data: data as {{{name}}} };
    }
    return { valid: false, errors: validate.errors || [] };
}

export function validate{{{name}}}Sync(data: unknown): {{{name}}} {
    const validate = ajv.compile({{{name}}}Schema);
    const valid = validate(data);
    if (!valid) {
        throw new Error(ajv.errorsText(validate.errors));
    }
    return data as {{{name}}};
}